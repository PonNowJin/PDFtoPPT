<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Paper to Slide Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .dropzone {
        border: 2px dashed #cbd5e1;
        border-radius: 0.5rem;
        padding: 2rem;
        text-align: center;
        cursor: pointer;
        transition: background-color 0.2s ease-in-out;
      }
      .dropzone:hover {
        background-color: #f1f5f9;
      }
      .spinner {
        border-top-color: #3b82f6;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="bg-slate-50 flex flex-col min-h-screen">
    <nav class="bg-white shadow-sm sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <div class="flex items-center">
            <svg
              class="h-8 w-8 text-blue-600"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <span class="font-bold text-xl text-slate-800 ml-2"
              >Paper to Slide Generator</span
            >
          </div>
        </div>
      </div>
    </nav>

    <main
      class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-12 flex items-center justify-center"
    >
      <div class="w-full max-w-2xl">
        <div id="upload-section" class="text-center">
          <h1 class="text-3xl sm:text-4xl font-bold text-slate-800 mb-4">
            Paper to Slide Generator
          </h1>
          <p class="text-slate-600 mb-8">
            Drag and drop your PDF here, or click to select a file.
          </p>

          <form id="upload-form">
            <div
              id="dropzone"
              class="dropzone bg-white hover:bg-slate-50 transition-colors duration-300"
            >
              <input type="file" id="pdf-file" class="hidden" accept=".pdf" />
              <div class="flex flex-col items-center justify-center space-y-4">
                <svg
                  class="w-16 h-16 text-slate-400"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M12 16.5V9.75m0 0l-3 3m3-3l3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.338 0 4.5 4.5 0 01-1.41 8.775H6.75z"
                  />
                </svg>
                <p class="text-lg font-semibold text-slate-700">
                  Drag and drop your PDF here
                </p>
                <p class="text-sm text-slate-500">Or click to select a file</p>
                <button
                  type="button"
                  id="select-file-button"
                  class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"
                >
                  Select File
                </button>
              </div>
            </div>
            <p id="file-name-display" class="mt-4 text-sm text-slate-600"></p>
            <button
              type="submit"
              id="submit-button"
              class="hidden mt-6 w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 disabled:opacity-50"
              disabled
            >
              Generate Slides
            </button>
          </form>
          <p id="error-message" class="mt-4 text-red-500 text-sm"></p>
        </div>

        <div id="loading-section" class="hidden text-center">
          <h2 class="text-2xl font-semibold text-slate-700 mb-4">
            Your file is being processed. Please wait...
          </h2>
          <div class="flex justify-center items-center mt-8">
            <div
              class="spinner w-12 h-12 border-4 border-slate-200 border-t-blue-600 rounded-full animate-spin"
            ></div>
          </div>
          <p class="text-slate-500 mt-4">This may take a few moments ...</p>
        </div>

        <div id="download-section" class="hidden text-center">
          <svg
            class="w-20 h-20 text-green-500 mx-auto mb-4"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          <h2 class="text-3xl font-bold text-slate-800 mb-6">
            Your presentation is ready!
          </h2>
          <a
            id="download-link"
            href="#"
            class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg text-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"
          >
            Download Presentation
          </a>
          <button
            id="convert-another"
            class="mt-8 text-blue-600 hover:text-blue-700 font-semibold py-2 px-4"
          >
            Convert another PDF
          </button>
        </div>
      </div>
    </main>

    <footer class="bg-white border-t border-slate-200 mt-auto">
      <div
        class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-sm text-slate-500"
      ></div>
    </footer>

    <script>
      const uploadForm = document.getElementById("upload-form");
      const pdfFileInput = document.getElementById("pdf-file");
      const dropzone = document.getElementById("dropzone");
      const selectFileButton = document.getElementById("select-file-button");
      const fileNameDisplay = document.getElementById("file-name-display");
      const submitButton = document.getElementById("submit-button");
      const errorMessage = document.getElementById("error-message");

      const uploadSection = document.getElementById("upload-section");
      const loadingSection = document.getElementById("loading-section");
      const downloadSection = document.getElementById("download-section");
      const downloadLink = document.getElementById("download-link");
      const convertAnotherButton = document.getElementById("convert-another");

      // Drag and Drop
      dropzone.addEventListener("click", () => pdfFileInput.click());

      dropzone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropzone.classList.add("bg-slate-100");
      });

      dropzone.addEventListener("dragleave", (e) => {
        e.preventDefault();
        dropzone.classList.remove("bg-slate-100");
      });

      dropzone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropzone.classList.remove("bg-slate-100");
        const files = e.dataTransfer.files;
        if (files.length > 0 && files[0].type === "application/pdf") {
          pdfFileInput.files = files;
          handleFileChange();
        } else {
          fileNameDisplay.textContent = "Please drop a PDF file.";
          fileNameDisplay.classList.add("text-red-500");
          submitButton.classList.add("hidden");
          submitButton.disabled = true;
        }
      });

      selectFileButton.addEventListener("click", (e) => {
        e.stopPropagation();
        pdfFileInput.click();
      });

      pdfFileInput.addEventListener("change", handleFileChange);

      function handleFileChange() {
        errorMessage.textContent = "";
        if (pdfFileInput.files.length > 0) {
          const file = pdfFileInput.files[0];
          if (file && file.type === "application/pdf") {
            fileNameDisplay.textContent = `Selected file: ${file.name}`;
            fileNameDisplay.classList.remove("text-red-500");
            submitButton.classList.remove("hidden");
            submitButton.disabled = false;
          } else if (file) {
            fileNameDisplay.textContent =
              "Invalid file type. Please select a PDF.";
            fileNameDisplay.classList.add("text-red-500");
            pdfFileInput.value = "";
            submitButton.classList.add("hidden");
            submitButton.disabled = true;
          } else {
            fileNameDisplay.textContent =
              "File selection error. Please try again.";
            fileNameDisplay.classList.add("text-red-500");
            pdfFileInput.value = "";
            submitButton.classList.add("hidden");
            submitButton.disabled = true;
          }
        } else {
          fileNameDisplay.textContent = "";
          submitButton.classList.add("hidden");
          submitButton.disabled = true;
        }
      }

      uploadForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        const file = pdfFileInput.files[0];

        if (!file) {
          errorMessage.textContent = "Please select a PDF file first.";
          return;
        }
        errorMessage.textContent = "";

        // Show loading
        uploadSection.classList.add("hidden");
        loadingSection.classList.remove("hidden");
        downloadSection.classList.add("hidden");

        const formData = new FormData();
        formData.append("file", file);

        try {
          const response = await fetch("/uploadfile/", {
            method: "POST",
            body: formData,
          });

          if (!response.ok) {
            const errorData = await response.json().catch(() => ({
              detail: "An unknown error occurred during processing.",
            }));
            throw new Error(
              errorData.detail || `Server error: ${response.status}`
            );
          }

          const blob = await response.blob();

          if (
            blob.type ===
              "application/vnd.openxmlformats-officedocument.presentationml.presentation" ||
            blob.type === "application/vnd.ms-powerpoint"
          ) {
            const url = URL.createObjectURL(blob);
            downloadLink.href = url;

            // Suggest a filename based on the original PDF name
            const originalFileName =
              file.name.substring(0, file.name.lastIndexOf(".")) ||
              "presentation";
            downloadLink.download = `${originalFileName}.pptx`;

            // Show download
            loadingSection.classList.add("hidden");
            downloadSection.classList.remove("hidden");
          } else {
            console.error("Received unexpected content type:", blob.type);
            throw new Error(
              "The server did not return a PPT/PPTX file. Received: " +
                blob.type
            );
          }
        } catch (error) {
          console.error("Error uploading file:", error);
          errorMessage.textContent = `Upload failed: ${error.message}`;

          // Show error and revert to upload
          loadingSection.classList.add("hidden");
          uploadSection.classList.remove("hidden");

          // Reset file input and button for re-upload
          pdfFileInput.value = "";
          fileNameDisplay.textContent = "";
          submitButton.classList.add("hidden");
          submitButton.disabled = true;
        }
      });

      convertAnotherButton.addEventListener("click", () => {
        uploadSection.classList.remove("hidden");
        downloadSection.classList.add("hidden");
        loadingSection.classList.add("hidden");
        pdfFileInput.value = ""; // Clear the file input
        fileNameDisplay.textContent = "";
        submitButton.classList.add("hidden");
        submitButton.disabled = true;
        errorMessage.textContent = "";
        if (downloadLink.href && downloadLink.href.startsWith("blob:")) {
          URL.revokeObjectURL(downloadLink.href); // Clean up the blob URL
        }
      });
    </script>
  </body>
</html>
